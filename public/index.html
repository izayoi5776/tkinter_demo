<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <!--style >
      table, th, td {
        border: 1px solid black;
        border-collapse: collapse;
      }
    </style-->
  </head>
  <body>
    <div id="app-8">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="/">Home</a></li>
          <li 
            v-for="(b, index) in bread"
            class="breadcrumb-item"
            v-bind:class="{active: index < bread.length - 1}"
          >
            <a 
              v-if="index < bread.length - 1"
              v-bind:href="'?s=' + breadlink[index]"
            >{{ b }}</a>
            <span v-else>{{ b }}</span>
          </li>
          <!--li class="breadcrumb-item active" aria-current="page">Data</li-->
        </ol>
      </nav>
      <table class="table table-bordered table-hover">
        <tr class="table-primary">
          <th>Name</th>
          <th>Type</th>
          <th>Doc</th>
        </tr>
        <tr>
          <td>{{ info.data.search_target }}</td>
          <td>{{ info.data.type }}</td>
          <td>{{ info.data.doc }}</td>
        </tr>
        <tr is='vue:todo_item'
          v-for="d in info.data.dir"
          v-bind:todo="info.data.search_target + '.' + d"
          v-bind:key="d"
        ></tr>
      </table>
    </div>
  </body>

  <!--script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script-->
  <script src="https://unpkg.com/vue@next"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.js"></script>
  <script src="/component/comp-row.js"></script>
  <script>

    const app = Vue.createApp({
      data () {
        return {
          info: {
            data: {
              search_target: '',
              type: '',
              doc: '',
              dir: []
            }
          },
        }
      },
      mounted () {
        params = new URLSearchParams(location.search);
        search_target = "os"
        if(params.has('s')) {
          search_target = params.get('s');
        }
        axios
        .get('/rest/' + search_target)
        .then(response => (this.info = response))
        .catch(error => console.log(error))
      },
      computed:{
        bread: function() {
          return this.info.data.search_target.split('.');
        },
        breadlink: function() {
          ret = [this.bread[0]];
          for(var i = 1; i < this.bread.length; i++) {
            ret[i] = ret[i-1] + "." + this.bread[i];
          }
          return ret;
        }
      }
    })

    app.component('todo_item', {
      //name: 'todo_item',
      props: ['todo'],
      data(){
        return {
          info: {
            data: {
              search_target: '',
              type: '',
              doc: '',
              dir: []
          }
        }
        }
      },
      computed:{
        rdoc : function(){
          try{
            return this.info.data.doc.replace(/\n/g, '<br>');
          } catch{
            return '';
          }
        }
      },
      mounted () {
        //print("this=" + this);
        //print("this.todo=" + this.todo);
        //print("prpos=" + this);
        axios
        .get('/rest/' + this.todo)
        .then(response => (this.info = response))
        .catch(error => console.log(error))
      },
    template:`
      <tr>
      <td><a :href="'?s=' + info.data.search_target">{{ info.data.search_target }}</a></td>
      <td>{{ info.data.type }}</td>
      <td v-html="rdoc"></td>
      </tr>`
    })

    app.mount('#app-8')

  </script>
</html>